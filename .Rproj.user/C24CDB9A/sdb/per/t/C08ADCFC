{
    "collab_server" : "",
    "contents" : "#\n#\n####\n\nlibrary(ggplot2)\nlibrary(scales)\nlibrary(dplyr)\nlibrary(RColorBrewer)\n\n\n#DC Purchase Order 2015 Data\ndc_po_data <- read.csv(\"Purchase_order_FY15.csv\",header=TRUE)\ncolnames(dc_po_data) <- c('Agency','Commodity','Supplier','Date','PO','Amount')\n###>>> Basic Transformations\ndc_po_data$Amount <- as.numeric(dc_po_data$Amount)\ndc_po_data$Date <- as.Date(as.character(dc_po_data$Date), \"%d-%b-%y\")\ndc_po_data$MonthYear <- paste(year(dc_po_data$Date),'-',month(dc_po_data$Date),sep='')\n\n\n### --- Aggregate() to sum(PO.amount) by Date\nbydate_agg_data <- filter(aggregate(cbind(Amount)~Date+Agency,dc_po_data,sum),Amount>250000)\n\n### --- Currency formatting for Amount column\nbydate_agg_data$DollarsSpent <- paste(\"$\",format(bydate_agg_data$Amount, big.mark=\",\"),sep=\"\") \n\n### --- Quick plot of \nqplot(bydate_agg_data$Date,bydate_agg_data$Amount) +\n  aes(group=bydate_agg_data$Date, color = bydate_agg_data$Agency) +\n  geom_point(stat=\"identity\") + \n  ggtitle(\"'Big Spenders' - Agencies with > $250,000 Individual POs\")+\n  #geom_text(aes(label=bydate_agg_data$Amount), vjust=0) +\n  #scale_color_hue()+\n  scale_x_date(date_breaks = '1 week', limits = c(as.Date('2014-11-01'), NA))+\n  scale_y_log10(labels=dollar) + theme(legend.position=\"right\") +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1))\n\n\n\n#--------------<>------D---P---L---Y---R-------<>------<>------<>------<>------<>\n#dplyr fxs\n#Unique fields\nAgencies <- distinct(select(dc_po_data,Agency))\n\n#for shiny UI selectInput choices arg.\nrow.names(Agencies) <- Agencies$Agency\n\n#distinct Supplier names\nSupplier <- distinct(select(dc_po_data,Supplier))\n\n#dplyr summarisations ###\nby_agency <- group_by(dc_po_data,Agency)\npurchases_by_agency <- arrange(summarise(by_agency,\n                                 count_suppliers = n_distinct(Supplier),\n                                 count=n(),\n                                 amount=sum(Amount),\n                                 avg_po_amt=amount/count,\n                                 avg_inv_per_supplier=count/count_suppliers), desc(amount))\n\n#Filter purchases_by_agency to include only agencies who have spent more than $1,000,000 in the year\n##\n###\n###% FILTERED DATASET & PLOTS\n###%\n###\n##\n#\n\n#dplyr filter purchases_by_agency for top agencies\ntop_agencies <- arrange(filter(purchases_by_agency,amount>100000),desc(amount))\n\n#order top_agencies for ggplot2\ntop_agencies$Agency <- factor(top_agencies$Agency,\n                             levels=top_agencies$Agency[order(top_agencies$amount)])\n\n##  ** CAN't Execute the below and still use as aesthetics **\n#>>>  #Convert columns with dollar amounts to currency format\n#top_agencies$amount <- paste(\"$\",format(top_agencies$amount, big.mark=\",\"),sep=\"\")\n#top_agencies$avg_po_amt <- paste(\"$\",format(top_agencies$avg_po_amt, big.mark=\",\"),sep=\"\")\n\n\n#  PLOT OF TOP_AGENCIES\n\ntop_agency_plot <- ggplot(top_agencies,aes(x=amount,y=Agency,size=avg_inv_per_supplier,color=Agency,frame=MonthYear))+\n    geom_point()+\n    #scale_color_continuous()+\n    #geom_text(aes(hjust=\"inward\",label=paste(\"$\",top_agencies$amount)))+\n    scale_x_log10(labels=dollar)+\n      ggtitle(\"DC Public Purchase Orders \\n Agencies with >$100K/Mo. \\n Spending Y-M:\") + \n    theme(plot.title = element_text(lineheight=.8, face=\"bold\"),legend.position=\"none\")+\n    labs(size=\"Avg. Purchases per Supplier\", colour=\"Avg. PO Amount\")\n\n#gg_animate\ngg_animate(top_agency_plot,\"output.gif\")\n\n#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  googleVis for Shiny implementation            %%%%%%%%%%%%%%%%%%%%\n#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%\n\nagency_barchart <- gvisBarChart(top_agencies, xvar=\"Agency\",yvar=\"amount\",\n                                options = list(height=1000, witdh=3000,\n                                               chartArea=\"{left:250,top:50,width:\\\"50%\\\",height:\\\"75%\\\"}\",\n                                               fontName = \"Arial\",\n                                               fontSize = 12\n                                               )\n                                )\nplot(agency_barchart)\n\n\n#-----<><><><><><>-----<><><><><><>-----<><><><><><>-----<><><><><><>-----<><><><><><>\nbubble1 <- gvisBubbleChart(top_agencies, \n                           idvar=\"Agency\", \n                           xvar=\"amount\", \n                           yvar=\"count_suppliers\", \n                           sizevar =\"amount\",\n                           colorvar = \"avg_po_amt\",\n                           options = list(height=1000,\n                                          fontName = \"Arial\",\n                                          fontSize = 10,\n                                          hAxis='{minValue:250000,maxValue:60000000}',\n                                          vAxis='{minValue:-100,maxValue:1000}',\n                                          vAxis.logScale='true',\n                                          explorer = list(),\n                                          tooltip = list(\n                                          textStyle = list(\n                                             fontSize = 10\n                                            )\n                                           )\n                                         )\n                           )\nplot(bubble1)\n\n\nnew_dataset <- dc_po_data  \nplot(gvisTable(top_agencies))\n#%%%%%%%%%%%%%%%%%%%%%%%%%%%\n#%%%%%%%%%%%%%%%%%%%%%%%%%%\n#%%%%%%%%%%%%%%%%%%%%%%%%%\n#%%%%%%%%%%%%%%%%%%%%%%%%\n#%%%%%%%%%%%%%%%%%%%%%%%\n#%%%%%%%%%%%%%%%%%%%%%%\n#%%%%%%%%%%%%%%%%%%%%%\n#%%%%%%%%%%%%%%%%%%%%\n#%%%%%%%%%%%%%%%%%%%\n#%%%%%%%%%%%%%%%%%%\n#%%%%%%%%%%%%%%%%%\n\n\n#######%\n######%\n#####%\n####%\n###%\n###\n##\n#\n\n\n#----------------------------------------------------------------------------------------------------------<><><><><><><><><><><><>---#\n\n\n######<><><><><><><><><><><><><>\nby_type <- group_by(dc_po_data,Commodity)\npurchases_by_type <- summarise(by_type,\n                               count_suppliers = n_distinct(Supplier),\n                               count=n(),\n                               amount=sum(Amount),\n                               average_po_amt=amount/count,\n                               pos_per_supplier=count/count_suppliers)\n\n\n\nqplot(top_agencies$Agency,top_agencies$amount)\n\nplot(top_agency_plot)\n#------<>------<>------D---P---L---Y---R-------<>------<>------<>------<>------<>\n\n#plot of full data set individual points\nfullplot <- ggplot(dc_po_data,aes(x=Date,y=Amount,color=Agency))+\n  geom_point()+\n  theme(plot.title = element_text(lineheight=.8, face=\"bold\"),legend.position=c(.78,.25))+\n  scale_x_date(date_breaks='1 month')+\n  #coord_trans(y=\"log10\")+\n  scale_y_log10(labels=dollar)+\n  theme(axis.text.x = element_text(angle=90,hjust=1))\nplot(fullplot)\n\n#plot of purchases by agency ##modified for gg_animate\n###\n#\nagencyplot <- ggplot(purchases_by_agency,aes(x=count,y=amount,size=count_suppliers,color=amount,frame=Agency))+\n  geom_point()+ \n  ggtitle(\"DC Public Purchase Orders \\n 10-2014 - 3-2015 \\n Agency: \")+\n  theme(plot.title = element_text(lineheight=.8, face=\"bold\"),legend.position=c(.78,.35))+\n  coord_trans(x = \"log10\")+coord_trans(y=\"log10\")+\n  scale_y_log10(labels=dollar)+scale_x_log10()+\n  xlab(\"Number of Transactions\")\n  theme(axis.text.x = element_text(angle=90,hjust=1))\nplot(agencyplot)\n\ngg_animate(agencyplot,\"PO_animation2.gif\",interval=1.3)\n\n#purchases by commodity\ncommplot <- ggplot(purchases_by_type,aes(x=count_suppliers,y=amount,size=amount,color=average_po_amt))+\n  geom_point()+\n  theme(plot.title = element_text(lineheight=.8, face=\"bold\"),legend.position=c(.78,.25))+\n  #coord_trans(x = \"log10\")+coord_trans(y=\"log10\")+\n  scale_y_log10(labels=dollar)+scale_x_log10()+\n  theme(axis.text.x = element_text(angle=90,hjust=1))\nplot(commplot)\n\n\n\n###DPLYR FOR SHINY IMPLEMENTATION\nfiltered_set <- filter(dc_po_data,Agency==Agency)\nfiltered_set$Agency <- factor(filtered_set$Agency,levels=filtered_set$Agency[order(filtered_set$Amount)])\n\nfil_set <- dc_po_data\nnew_fil_set <- fil_set\n#### ggplot + coord_trans() frequent no plot\n######## Error resolved >>> make sure limits=c(minval exists,NA)\n#  scale_x_date(limits = c(as.Date('2015-10-01'), NA))+\n#  scale_y_continuous(labels = dollar) + theme(legend.position=\"none\")\n#Error in matrix(value, n, p) : \n#  'data' must be of a vector type, was 'NULL'\n\n######\n#\n#\n\n\n\n#filter() (and slice())\n#_______________________________________\n#\n#  filter(flights, month == 1, day == 1)\n\n#arrange()\n#\n#   arrange(flights, desc(arr_delay))\n\n#select() (and rename())\n#\n#   Select all columns except those from year to day (inclusive)\n#   select(flights, -(year:day))\n#\n#distinct()\n#\n#\n#\n#mutate() (and transmute())\n#\n#\n#\n#summarise()\n#\n#\n#\n#sample_n() and sample_frac()\n\n\n###--------Example of geom_text adjustments -----------###\n#geom_text(aes(x=filename, y=value, ymax=value, label=value, \n#hjust=ifelse(sign(value)>0, 1, 0)), \n#position = position_dodge(width=1))\n###----------------------------------------------------###\n#\n#\n############################################################\n",
    "created" : 1457359018595.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2779850568",
    "id" : "C08ADCFC",
    "lastKnownWriteTime" : 1458061853,
    "last_content_update" : 1458061853683,
    "path" : "~/Documents/project/DC_POs_2015/DC_Purchase_Orders_2015.R",
    "project_path" : "DC_Purchase_Orders_2015.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}